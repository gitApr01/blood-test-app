import React, {useEffect,useState} from 'react'
import { get, put } from '../api.js'
import { useNavigate } from 'react-router-dom'
export default function AllTests(){ const nav = useNavigate(); const [list,setList] = useState([]); const [q,setQ]=useState(''); async function load(){ try{ const r = await get('/all_tests'); setList(r); }catch(e){console.error(e)} } useEffect(()=>{ load() },[])
async function setStatus(id,status){ try{ await put(`/update_status/${id}`,{status}); load(); }catch(e){console.error(e)} }
return (<div><div className="card"><h2 className="h2">All Tests</h2><div className="filters"><input className="input" placeholder="Search by patient or test" value={q} onChange={e=>setQ(e.target.value)} /></div><table className="table"><thead><tr><th>Patient</th><th>Tests</th><th>Total</th><th>Due</th><th>Status</th><th></th></tr></thead><tbody>{list.filter(r=>!q || r.patient_name.toLowerCase().includes(q.toLowerCase()) || (r.tests_selected||'').toLowerCase().includes(q.toLowerCase())).map(r=>(<tr key={r.id}><td>{r.patient_name}</td><td>{(r.tests_selected||r.tests||[]).toString()}</td><td>₹{Number(r.total||0).toFixed(2)}</td><td>₹{Number(r.due||0).toFixed(2)}</td><td className="small">{r.delivery_status}</td><td><button className="btn" onClick={()=>nav(`/tests/${r.id}/edit`)}>Edit</button><button className="btn" style={{marginLeft:8}} onClick={()=>setStatus(r.id,'Fully Delivered')}>Mark Delivered</button></td></tr>))}</tbody></table></div></div>) }
